---
import BaseLayout from "../BaseLayout.astro";
import Feature from "../../components/Layout/Feature.astro";
import Prose from "../../components/MDX/Prose.astro";
import TableOfContents from "../../components/Layout/TableOfContents.astro";
import PageTopChevron from "../../components/Layout/PageTopChevron.astro";
import { render } from "astro:content";
import "../styles/post_base.css";
import "katex/dist/katex.min.css";
import { components } from "../../components/MDX/MDXComponents";

const { entry, contentStyle = "", featureStyle = "" } = Astro.props;
const frontmatter = entry.data;

// Set site root constant (could move to config/env in future)
const SITE_ROOT = "https://patrickyoussef.com";

// Blog posts assumed to be under /blog/[slug]/, update if using other collections
const postUrl = `${SITE_ROOT}/blog/${frontmatter.slug}/`;

// Support Open Graph/social/SEO meta fields via BaseLayout meta prop
const meta = {
  title: frontmatter.title,
  description: frontmatter.excerpt ?? "",
  image: frontmatter.cover,
  // Fall back to some default image if desired
  url: postUrl,
};

const { Content, remarkPluginFrontmatter, headings } = await render(entry);
let numHeadings = headings.filter((item) => item.depth === 2).length;
---

<BaseLayout title={frontmatter.title} meta={meta}>
  <div class={`fade-in-fast ${contentStyle}`}>
    <Feature entry={entry} frontmatter={remarkPluginFrontmatter} extraStyle={`${featureStyle}`} />
    <div class="lg:grid lg:grid-cols-[1fr_auto_1fr]">
      <div class="hidden lg:block"></div>
      <Prose>
        <div class={`post-content space-y-[1.25rem] ${contentStyle}`}>
          <Content components={components} />
        </div>
      </Prose>
      <div class="hidden lg:block h-fit sticky top-10">
        {numHeadings >= 5 && <TableOfContents headings={headings} />}
      </div>
    </div>
  </div>
  <PageTopChevron />
</BaseLayout>
